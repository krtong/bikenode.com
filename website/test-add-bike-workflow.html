<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Add-Bike Motorcycle Specs Workflow</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #0a0a0a;
            color: #fff;
        }
        
        .container {
            background: #111;
            padding: 30px;
            border-radius: 12px;
            border: 1px solid #333;
        }
        
        h1 {
            color: #fff;
            margin-bottom: 30px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .workflow-step {
            margin: 20px 0;
            padding: 20px;
            background: #1a1a1a;
            border-radius: 8px;
            border: 1px solid #333;
        }
        
        .step-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .step-number {
            background: #5865f2;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        select, button {
            padding: 10px 15px;
            margin: 5px;
            background: #2a2a2a;
            border: 1px solid #444;
            color: white;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
        }
        
        select:hover, button:hover {
            background: #333;
            border-color: #555;
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .result-box {
            margin-top: 15px;
            padding: 15px;
            background: #0a0a0a;
            border-radius: 6px;
            border: 1px solid #333;
            font-family: monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .spec-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .spec-item {
            background: #2a2a2a;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #333;
        }
        
        .spec-label {
            font-size: 12px;
            color: #888;
            text-transform: uppercase;
            margin-bottom: 5px;
        }
        
        .spec-value {
            font-size: 14px;
            color: #fff;
            font-weight: 500;
        }
        
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 6px;
            display: none;
        }
        
        .status.success {
            background: #1a2f1a;
            border: 1px solid #2f4f2f;
            color: #4ade80;
            display: block;
        }
        
        .status.error {
            background: #2f1a1a;
            border: 1px solid #4f2f2f;
            color: #f87171;
            display: block;
        }
        
        .status.info {
            background: #1a1a2f;
            border: 1px solid #2f2f4f;
            color: #60a5fa;
            display: block;
        }
        
        .loading {
            display: inline-block;
            margin-left: 10px;
            color: #888;
        }
        
        .quick-test {
            margin-top: 30px;
            padding: 20px;
            background: #1a1a2f;
            border-radius: 8px;
            border: 1px solid #2f2f4f;
        }
        
        .test-button {
            background: #5865f2;
            border: none;
            color: white;
            padding: 12px 24px;
            margin: 5px;
            font-weight: 500;
        }
        
        .test-button:hover {
            background: #4752c4;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üèçÔ∏è Test Add-Bike Motorcycle Specs Workflow</h1>
        
        <div class="quick-test">
            <h3>Quick Tests - Motorcycles with Known Specs</h3>
            <button class="test-button" onclick="quickTest('Honda', 2022, 'Monkey 125')">
                Test Honda Monkey 2022
            </button>
            <button class="test-button" onclick="quickTest('Harley-Davidson', 2024, 'CVO Road Glide')">
                Test Harley CVO 2024
            </button>
            <button class="test-button" onclick="quickTest('BMW', 2025, 'C 400')">
                Test BMW C 400 2025
            </button>
            <button class="test-button" onclick="quickTest('Triumph', 2025, 'Bonneville Speedmaster')">
                Test Triumph Bonneville 2025
            </button>
        </div>
        
        <div class="workflow-step">
            <div class="step-header">
                <div class="step-number">1</div>
                <h3>Select Brand</h3>
            </div>
            <select id="brand-select" onchange="onBrandChange()">
                <option value="">Loading brands...</option>
            </select>
            <span class="loading" id="brand-loading" style="display: none;">Loading...</span>
        </div>
        
        <div class="workflow-step">
            <div class="step-header">
                <div class="step-number">2</div>
                <h3>Select Year</h3>
            </div>
            <select id="year-select" onchange="onYearChange()" disabled>
                <option value="">Select a brand first</option>
            </select>
            <span class="loading" id="year-loading" style="display: none;">Loading...</span>
        </div>
        
        <div class="workflow-step">
            <div class="step-header">
                <div class="step-number">3</div>
                <h3>Select Model</h3>
            </div>
            <select id="model-select" onchange="onModelChange()" disabled>
                <option value="">Select a year first</option>
            </select>
            <span class="loading" id="model-loading" style="display: none;">Loading...</span>
            <div class="result-box" id="model-info" style="display: none;"></div>
        </div>
        
        <div class="workflow-step">
            <div class="step-header">
                <div class="step-number">4</div>
                <h3>View Specifications</h3>
            </div>
            <button id="fetch-specs-btn" onclick="fetchSpecs()" disabled>
                Fetch Specifications
            </button>
            <div class="status" id="spec-status"></div>
            <div class="spec-grid" id="spec-grid"></div>
            <div class="result-box" id="spec-raw" style="display: none;"></div>
        </div>
        
        <div class="workflow-step">
            <h3>Debug Info</h3>
            <button onclick="showDebugInfo()">Show Debug Info</button>
            <div class="result-box" id="debug-info" style="display: none;"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:8080/api';
        let selectedMotorcycle = null;
        let allModels = [];
        
        // Initialize
        async function init() {
            await loadBrands();
        }
        
        async function loadBrands() {
            try {
                const response = await fetch(`${API_BASE}/motorcycles/makes`);
                const brands = await response.json();
                
                const select = document.getElementById('brand-select');
                select.innerHTML = '<option value="">Select a brand</option>';
                
                brands.forEach(brand => {
                    const option = document.createElement('option');
                    option.value = brand;
                    option.textContent = brand;
                    select.appendChild(option);
                });
                
                // Add brands with known specs at the top
                const knownSpecsBrands = ['Honda', 'Harley-Davidson', 'BMW', 'Triumph'];
                const separator = document.createElement('option');
                separator.disabled = true;
                separator.textContent = '‚îÄ‚îÄ Brands with Specs ‚îÄ‚îÄ';
                select.insertBefore(separator, select.children[1]);
                
                knownSpecsBrands.forEach((brand, index) => {
                    const existingOption = Array.from(select.options).find(opt => opt.value === brand);
                    if (existingOption) {
                        select.removeChild(existingOption);
                        select.insertBefore(existingOption, select.children[index + 2]);
                        existingOption.textContent = `${brand} ‚úÖ`;
                    }
                });
                
            } catch (error) {
                console.error('Error loading brands:', error);
                showStatus('spec-status', 'Error loading brands', 'error');
            }
        }
        
        async function onBrandChange() {
            const brand = document.getElementById('brand-select').value;
            if (!brand) return;
            
            document.getElementById('year-loading').style.display = 'inline';
            document.getElementById('year-select').disabled = true;
            document.getElementById('model-select').disabled = true;
            document.getElementById('fetch-specs-btn').disabled = true;
            
            try {
                const response = await fetch(`${API_BASE}/motorcycles/years/${encodeURIComponent(brand)}`);
                const years = await response.json();
                
                const select = document.getElementById('year-select');
                select.innerHTML = '<option value="">Select a year</option>';
                
                years.forEach(year => {
                    const option = document.createElement('option');
                    option.value = year;
                    option.textContent = year;
                    select.appendChild(option);
                });
                
                select.disabled = false;
                
            } catch (error) {
                console.error('Error loading years:', error);
                showStatus('spec-status', 'Error loading years', 'error');
            } finally {
                document.getElementById('year-loading').style.display = 'none';
            }
        }
        
        async function onYearChange() {
            const brand = document.getElementById('brand-select').value;
            const year = document.getElementById('year-select').value;
            if (!brand || !year) return;
            
            document.getElementById('model-loading').style.display = 'inline';
            document.getElementById('model-select').disabled = true;
            document.getElementById('fetch-specs-btn').disabled = true;
            
            try {
                const response = await fetch(`${API_BASE}/motorcycles/models/${encodeURIComponent(brand)}/${year}`);
                allModels = await response.json();
                
                const select = document.getElementById('model-select');
                select.innerHTML = '<option value="">Select a model</option>';
                
                // Group models by whether they have specs
                const modelsWithSpecs = [];
                const modelsWithoutSpecs = [];
                
                // For known brands with specs, mark specific models
                if (brand === 'Honda' && year >= 2019 && year <= 2025) {
                    allModels.forEach((model, index) => {
                        if (model.model.includes('Monkey') || model.model === 'Benly') {
                            modelsWithSpecs.push(index);
                        } else {
                            modelsWithoutSpecs.push(index);
                        }
                    });
                } else {
                    // For other brands, we don't know which have specs
                    allModels.forEach((model, index) => {
                        modelsWithoutSpecs.push(index);
                    });
                }
                
                // Add models with specs first
                if (modelsWithSpecs.length > 0) {
                    const separator = document.createElement('option');
                    separator.disabled = true;
                    separator.textContent = '‚îÄ‚îÄ Models with Specs ‚îÄ‚îÄ';
                    select.appendChild(separator);
                    
                    modelsWithSpecs.forEach(index => {
                        const model = allModels[index];
                        const option = document.createElement('option');
                        option.value = index;
                        option.textContent = `${model.model} ‚úÖ`;
                        select.appendChild(option);
                    });
                }
                
                // Add separator if needed
                if (modelsWithSpecs.length > 0 && modelsWithoutSpecs.length > 0) {
                    const separator = document.createElement('option');
                    separator.disabled = true;
                    separator.textContent = '‚îÄ‚îÄ Other Models ‚îÄ‚îÄ';
                    select.appendChild(separator);
                }
                
                // Add models without specs
                modelsWithoutSpecs.forEach(index => {
                    const model = allModels[index];
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = model.model;
                    if (model.package) {
                        option.textContent += ` (${model.package})`;
                    }
                    select.appendChild(option);
                });
                
                select.disabled = false;
                
                showStatus('spec-status', `Loaded ${allModels.length} models`, 'info');
                
            } catch (error) {
                console.error('Error loading models:', error);
                showStatus('spec-status', 'Error loading models', 'error');
            } finally {
                document.getElementById('model-loading').style.display = 'none';
            }
        }
        
        function onModelChange() {
            const modelIndex = document.getElementById('model-select').value;
            if (!modelIndex) return;
            
            selectedMotorcycle = allModels[modelIndex];
            document.getElementById('fetch-specs-btn').disabled = false;
            
            // Show model info
            const infoBox = document.getElementById('model-info');
            infoBox.style.display = 'block';
            infoBox.innerHTML = `
                <strong>Selected Motorcycle:</strong><br>
                ID: ${selectedMotorcycle.id}<br>
                ${selectedMotorcycle.year} ${selectedMotorcycle.make} ${selectedMotorcycle.model}<br>
                ${selectedMotorcycle.category ? `Category: ${selectedMotorcycle.category}<br>` : ''}
                ${selectedMotorcycle.engine ? `Engine: ${selectedMotorcycle.engine}` : ''}
            `;
        }
        
        async function fetchSpecs() {
            if (!selectedMotorcycle) return;
            
            const specGrid = document.getElementById('spec-grid');
            const specRaw = document.getElementById('spec-raw');
            specGrid.innerHTML = 'Loading specifications...';
            specRaw.style.display = 'none';
            
            try {
                const response = await fetch(`${API_BASE}/motorcycles/${selectedMotorcycle.id}/specs`);
                const data = await response.json();
                
                specRaw.style.display = 'block';
                specRaw.innerHTML = `<strong>Raw API Response:</strong>\n${JSON.stringify(data, null, 2)}`;
                
                if (data.hasSpecs) {
                    showStatus('spec-status', `‚úÖ Specifications found! (Spec ID: ${data.specId})`, 'success');
                    
                    // Display specs in grid
                    specGrid.innerHTML = '';
                    const specs = data.specifications;
                    
                    // Important specs to show first
                    const importantSpecs = [
                        'Engine', 'Capacity', 'Max Power', 'Max Torque',
                        'Transmission', 'Final Drive', 'Fuel Capacity',
                        'Seat Height', 'Wet Weight', 'Front Brakes', 'Rear Brakes'
                    ];
                    
                    // Show important specs first
                    importantSpecs.forEach(key => {
                        if (specs[key]) {
                            addSpecToGrid(key, specs[key], true);
                        }
                    });
                    
                    // Show remaining specs
                    Object.entries(specs).forEach(([key, value]) => {
                        if (!importantSpecs.includes(key)) {
                            addSpecToGrid(key, value, false);
                        }
                    });
                    
                } else {
                    showStatus('spec-status', `‚ùå ${data.message || 'No specifications available'}`, 'error');
                    specGrid.innerHTML = '<div style="padding: 20px; text-align: center; color: #888;">No specifications available for this motorcycle</div>';
                }
                
            } catch (error) {
                console.error('Error fetching specs:', error);
                showStatus('spec-status', `Error: ${error.message}`, 'error');
                specGrid.innerHTML = '<div style="color: red;">Error loading specifications</div>';
            }
        }
        
        function addSpecToGrid(label, value, isImportant) {
            const specGrid = document.getElementById('spec-grid');
            const specItem = document.createElement('div');
            specItem.className = 'spec-item';
            if (isImportant) {
                specItem.style.border = '1px solid #5865f2';
            }
            specItem.innerHTML = `
                <div class="spec-label">${label}</div>
                <div class="spec-value">${value}</div>
            `;
            specGrid.appendChild(specItem);
        }
        
        function showStatus(elementId, message, type) {
            const status = document.getElementById(elementId);
            status.textContent = message;
            status.className = `status ${type}`;
        }
        
        async function quickTest(brand, year, modelName) {
            // Set brand
            document.getElementById('brand-select').value = brand;
            await onBrandChange();
            
            // Set year
            document.getElementById('year-select').value = year;
            await onYearChange();
            
            // Find and select model
            const modelSelect = document.getElementById('model-select');
            for (let i = 0; i < modelSelect.options.length; i++) {
                if (modelSelect.options[i].text.includes(modelName)) {
                    modelSelect.value = modelSelect.options[i].value;
                    onModelChange();
                    
                    // Auto-fetch specs
                    setTimeout(() => fetchSpecs(), 500);
                    break;
                }
            }
        }
        
        function showDebugInfo() {
            const debugInfo = document.getElementById('debug-info');
            debugInfo.style.display = 'block';
            
            const info = {
                selectedBrand: document.getElementById('brand-select').value,
                selectedYear: document.getElementById('year-select').value,
                selectedModel: selectedMotorcycle,
                totalModelsLoaded: allModels.length,
                apiBase: API_BASE,
                timestamp: new Date().toISOString()
            };
            
            debugInfo.innerHTML = `<strong>Debug Information:</strong>\n${JSON.stringify(info, null, 2)}`;
        }
        
        // Initialize on load
        init();
    </script>
</body>
</html>