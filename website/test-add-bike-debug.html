<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Debug Add-Bike</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; background: #1a1a1a; color: white; }
        .container { max-width: 1200px; margin: 0 auto; }
        .status { padding: 10px; margin: 10px 0; border: 1px solid #333; background: #222; }
        .error { background: #5a2222; border-color: #aa2222; }
        .success { background: #225a22; border-color: #22aa22; }
        .panel { display: flex; gap: 20px; margin-top: 20px; }
        .menu { flex: 1; background: #222; padding: 20px; border: 1px solid #333; }
        .display { flex: 2; background: #222; padding: 20px; border: 1px solid #333; }
        button { display: block; width: 100%; padding: 10px; margin: 5px 0; background: #333; color: white; border: 1px solid #555; cursor: pointer; }
        button:hover { background: #444; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Add-Bike Debug Page</h1>
        
        <div id="status" class="status">Loading...</div>
        
        <div class="panel">
            <div class="menu">
                <h2>Categories</h2>
                <div id="menu-content">
                    <button onclick="selectCategory('bicycle')">üö¥ Bicycle</button>
                    <button onclick="selectCategory('motorcycle')">üèçÔ∏è Motorcycle</button>
                </div>
            </div>
            
            <div class="display">
                <h2>Results</h2>
                <div id="results">Select a category to begin</div>
            </div>
        </div>
        
        <h3>Debug Log:</h3>
        <pre id="log" style="background: #111; padding: 10px; height: 200px; overflow-y: auto;"></pre>
    </div>
    
    <script>
        const log = (msg) => {
            const logEl = document.getElementById('log');
            logEl.textContent += `${new Date().toISOString().split('T')[1].split('.')[0]} - ${msg}\n`;
            logEl.scrollTop = logEl.scrollHeight;
        };
        
        const status = document.getElementById('status');
        const results = document.getElementById('results');
        
        // Check API on load
        async function checkAPI() {
            log('Checking API status...');
            try {
                const response = await fetch('http://localhost:8080/api/health');
                const data = await response.json();
                status.className = 'status success';
                status.innerHTML = `‚úÖ API Connected - ${data.motorcycles} motorcycles, ${data.bicycles} bicycles`;
                log(`API check successful: ${JSON.stringify(data)}`);
            } catch (error) {
                status.className = 'status error';
                status.innerHTML = `‚ùå API Error: ${error.message}`;
                log(`API check failed: ${error.message}`);
            }
        }
        
        async function selectCategory(category) {
            log(`Selected category: ${category}`);
            results.innerHTML = `<h3>Loading ${category} brands...</h3>`;
            
            try {
                let brands = [];
                if (category === 'motorcycle') {
                    log('Fetching motorcycle makes...');
                    const response = await fetch('http://localhost:8080/api/motorcycles/makes');
                    brands = await response.json();
                    log(`Received ${brands.length} motorcycle brands`);
                } else {
                    log('Fetching bicycle manufacturers...');
                    const response = await fetch('http://localhost:8080/api/bicycles/manufacturers');
                    const data = await response.json();
                    brands = data.manufacturers || [];
                    log(`Received ${brands.length} bicycle brands`);
                }
                
                results.innerHTML = `<h3>${category === 'motorcycle' ? 'Motorcycle' : 'Bicycle'} Brands (${brands.length})</h3>`;
                results.innerHTML += '<div style="max-height: 300px; overflow-y: auto;">';
                brands.forEach(brand => {
                    results.innerHTML += `<button onclick="selectBrand('${category}', '${brand}')">${brand}</button>`;
                });
                results.innerHTML += '</div>';
                
            } catch (error) {
                results.innerHTML = `<div class="error">Error loading brands: ${error.message}</div>`;
                log(`Error loading brands: ${error.message}`);
            }
        }
        
        async function selectBrand(category, brand) {
            log(`Selected brand: ${brand} (${category})`);
            results.innerHTML = `<h3>Loading years for ${brand}...</h3>`;
            
            try {
                let years = [];
                if (category === 'motorcycle') {
                    const response = await fetch(`http://localhost:8080/api/motorcycles/years/${encodeURIComponent(brand)}`);
                    years = await response.json();
                } else {
                    const response = await fetch(`http://localhost:8080/api/bicycles/years/${encodeURIComponent(brand)}`);
                    const data = await response.json();
                    years = data.years || [];
                }
                
                log(`Received ${years.length} years for ${brand}`);
                results.innerHTML = `<h3>${brand} Years (${years.length})</h3>`;
                results.innerHTML += '<div style="max-height: 300px; overflow-y: auto;">';
                years.forEach(year => {
                    results.innerHTML += `<button onclick="log('Selected year: ${year}')">${year}</button>`;
                });
                results.innerHTML += '</div>';
                
            } catch (error) {
                results.innerHTML = `<div class="error">Error loading years: ${error.message}</div>`;
                log(`Error loading years: ${error.message}`);
            }
        }
        
        // Initialize
        checkAPI();
        log('Page loaded');
        
        // Test module loading
        log('Testing if modules would load...');
        const testImport = async () => {
            try {
                // Just check if the URLs are accessible
                const urls = [
                    '/add-bike/js/app.js',
                    '/add-bike/js/data-loader.js',
                    '/add-bike/js/views.js',
                    '/add-bike/js/navigation.js'
                ];
                
                for (const url of urls) {
                    const response = await fetch(url);
                    if (response.ok) {
                        log(`‚úÖ ${url} is accessible`);
                    } else {
                        log(`‚ùå ${url} returned ${response.status}`);
                    }
                }
            } catch (error) {
                log(`Module check error: ${error.message}`);
            }
        };
        testImport();
    </script>
</body>
</html>