<!DOCTYPE html>
<html lang="en">
<head>
    {% include "head.njk" %}
    
    {# A/B Test Setup Script #}
    <script>
    (function() {
        const urlParams = new URLSearchParams(window.location.search);
        const previewVariant = urlParams.get('preview');
        
        if (previewVariant) {
            localStorage.setItem('ab_test_group', previewVariant);
        } else {
            let testGroup = localStorage.getItem('ab_test_group');
            if (!testGroup) {
                testGroup = Math.random() < 0.5 ? 'control' : 'variant';
                localStorage.setItem('ab_test_group', testGroup);
            }
        }
        
        document.documentElement.classList.add('ab-test-' + (localStorage.getItem('ab_test_group') || 'control'));
        window.abTestGroup = localStorage.getItem('ab_test_group') || 'control';
    })();
    </script>
    
    <link rel="stylesheet" href="/assets/css/header-sidebar-v2.css">
</head>
<body class="dashboard-layout {% if bodyClass %}{{ bodyClass }}{% endif %}">
    {% include "background-canvas.njk" %}
    
    <div class="dashboard-wrapper">
        {# Conditionally render sidebar based on A/B test #}
        <div id="sidebar-container"></div>
        
        <script>
            // Render appropriate sidebar
            (function() {
                const sidebarContainer = document.getElementById('sidebar-container');
                if (window.abTestGroup === 'variant') {
                    // For variant, we'll include the V2 sidebar
                    sidebarContainer.innerHTML = `{% include "dashboard-sidebar-v2.njk" %}`;
                } else {
                    // For control, use the original sidebar
                    sidebarContainer.innerHTML = `{% include "dashboard-sidebar.njk" %}`;
                }
            })();
        </script>
        
        <main class="dashboard-content">
            {# Conditionally render header #}
            <div id="header-container"></div>
            
            <script>
                // Render appropriate header
                (function() {
                    const headerContainer = document.getElementById('header-container');
                    if (window.abTestGroup === 'variant') {
                        headerContainer.innerHTML = `{% include "dashboard-header.njk" %}`;
                    } else {
                        headerContainer.innerHTML = `{% include "dashboard-header.njk" %}`;
                    }
                })();
            </script>
            
            <div class="page-content">
                {{ content | safe }}
            </div>
        </main>
    </div>
    
    {% include "scripts.njk" %}
    <script src="/assets/js/ab-test-analytics.js"></script>
</body>
</html>