<header class="main-header-v2">
    <div class="header-container">
        <!-- Logo and brand -->
        <div class="header-brand">
            <a href="/" class="brand-link">
                <img src="/assets/images/bikenode_logo.png" alt="BikeNode" class="brand-logo">
                <span class="brand-text">BikeNode</span>
            </a>
        </div>
        
        <!-- Main navigation -->
        <nav class="header-nav" aria-label="Main navigation">
            <a href="/marketplace/" class="nav-link{% if page.url.includes('/marketplace') %} active{% endif %}">
                <span class="nav-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="9" cy="21" r="1"></circle>
                        <circle cx="20" cy="21" r="1"></circle>
                        <path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path>
                    </svg>
                </span>
                <span class="nav-text">Marketplace</span>
            </a>
            
            <a href="/routes-gallery/" class="nav-link{% if page.url.includes('/routes') %} active{% endif %}">
                <span class="nav-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
                        <circle cx="12" cy="10" r="3"></circle>
                    </svg>
                </span>
                <span class="nav-text">Routes</span>
            </a>
            
            <a href="/communities/" class="nav-link{% if page.url.includes('/communit') %} active{% endif %}">
                <span class="nav-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
                        <circle cx="9" cy="7" r="4"></circle>
                        <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
                        <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
                    </svg>
                </span>
                <span class="nav-text">Communities</span>
            </a>
            
            <a href="/events/" class="nav-link{% if page.url.includes('/events') %} active{% endif %}">
                <span class="nav-icon">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                        <line x1="16" y1="2" x2="16" y2="6"></line>
                        <line x1="8" y1="2" x2="8" y2="6"></line>
                        <line x1="3" y1="10" x2="21" y2="10"></line>
                    </svg>
                </span>
                <span class="nav-text">Events</span>
            </a>
        </nav>
        
        <!-- Search bar -->
        <div class="header-search">
            <form action="/search/" method="get" class="search-form">
                <input type="search" name="q" placeholder="Search bikes, routes, users..." class="search-input" aria-label="Search">
                <button type="submit" class="search-button" aria-label="Submit search">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="11" cy="11" r="8"></circle>
                        <path d="m21 21-4.35-4.35"></path>
                    </svg>
                </button>
            </form>
        </div>
        
        <!-- User actions -->
        <div class="header-actions">
            <!-- Notifications -->
            <button class="action-button notifications-button" aria-label="Notifications" data-notifications="3">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"></path>
                    <path d="M13.73 21a2 2 0 0 1-3.46 0"></path>
                </svg>
                <span class="notification-dot"></span>
            </button>
            
            <!-- Messages -->
            <a href="/messages/" class="action-button messages-button" aria-label="Messages">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"></path>
                    <polyline points="22,6 12,13 2,6"></polyline>
                </svg>
            </a>
            
            <!-- User menu -->
            <div class="user-menu">
                <button class="user-menu-button" aria-label="User menu" aria-expanded="false">
                    <img src="/assets/images/user-avatar.jpg" alt="User" class="user-avatar">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="dropdown-icon">
                        <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                </button>
                
                <div class="user-dropdown" hidden>
                    <div class="dropdown-header">
                        <img src="/assets/images/user-avatar.jpg" alt="User" class="dropdown-avatar">
                        <div class="dropdown-info">
                            <span class="dropdown-name">John Doe</span>
                            <span class="dropdown-email">john@example.com</span>
                        </div>
                    </div>
                    <div class="dropdown-divider"></div>
                    <a href="/dashboard/" class="dropdown-link">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <rect x="3" y="3" width="7" height="7"></rect>
                            <rect x="14" y="3" width="7" height="7"></rect>
                            <rect x="14" y="14" width="7" height="7"></rect>
                            <rect x="3" y="14" width="7" height="7"></rect>
                        </svg>
                        Dashboard
                    </a>
                    <a href="/profile/" class="dropdown-link">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                            <circle cx="12" cy="7" r="4"></circle>
                        </svg>
                        Profile
                    </a>
                    <a href="/virtual-garage-dashboard/" class="dropdown-link">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="5.5" cy="17.5" r="3.5"></circle>
                            <circle cx="18.5" cy="17.5" r="3.5"></circle>
                            <path d="M12 17.5V14l-3-3 4-3 2 3h2"></path>
                        </svg>
                        My Garage
                    </a>
                    <a href="/account-settings/" class="dropdown-link">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="3"></circle>
                            <path d="M12 1v6m0 6v6m11-11h-6m-6 0H1"></path>
                        </svg>
                        Settings
                    </a>
                    <div class="dropdown-divider"></div>
                    <a href="/logout/" class="dropdown-link logout-link">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path>
                            <polyline points="16 17 21 12 16 7"></polyline>
                            <line x1="21" y1="12" x2="9" y2="12"></line>
                        </svg>
                        Log out
                    </a>
                </div>
            </div>
            
            <!-- Get started button for logged out users -->
            <a href="/signup/" class="get-started-button">Get Started</a>
        </div>
        
        <!-- Mobile menu button -->
        <button class="mobile-menu-button" aria-label="Toggle menu" aria-expanded="false">
            <span class="menu-icon">
                <span></span>
                <span></span>
                <span></span>
            </span>
        </button>
    </div>
    
    <!-- Mobile navigation -->
    <div class="mobile-nav" hidden>
        <form action="/search/" method="get" class="mobile-search">
            <input type="search" name="q" placeholder="Search..." class="mobile-search-input" aria-label="Search">
        </form>
        
        <nav class="mobile-nav-links">
            <a href="/marketplace/" class="mobile-nav-link">Marketplace</a>
            <a href="/routes-gallery/" class="mobile-nav-link">Routes</a>
            <a href="/communities/" class="mobile-nav-link">Communities</a>
            <a href="/events/" class="mobile-nav-link">Events</a>
            <a href="/dashboard/" class="mobile-nav-link">Dashboard</a>
            <a href="/profile/" class="mobile-nav-link">Profile</a>
            <a href="/account-settings/" class="mobile-nav-link">Settings</a>
        </nav>
    </div>
</header>

<style>
/* Modern header design */
.main-header-v2 {
    position: sticky;
    top: 0;
    z-index: 100;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(229, 231, 235, 0.8);
}

.header-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 1.5rem;
    height: 4rem;
    display: flex;
    align-items: center;
    gap: 2rem;
}

/* Brand */
.header-brand {
    flex-shrink: 0;
}

.brand-link {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    text-decoration: none;
}

.brand-logo {
    height: 2rem;
}

.brand-text {
    font-weight: 700;
    font-size: 1.25rem;
    color: #111827;
}

/* Navigation */
.header-nav {
    display: flex;
    gap: 0.5rem;
}

.nav-link {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
    color: #4b5563;
    text-decoration: none;
    font-weight: 500;
    transition: all 0.2s ease;
}

.nav-link:hover {
    background-color: #f3f4f6;
    color: #111827;
}

.nav-link.active {
    background-color: #eff6ff;
    color: #3b82f6;
}

.nav-icon {
    display: flex;
    align-items: center;
}

.nav-text {
    font-size: 0.875rem;
}

/* Search */
.header-search {
    flex: 1;
    max-width: 25rem;
}

.search-form {
    position: relative;
}

.search-input {
    width: 100%;
    padding: 0.5rem 2.5rem 0.5rem 1rem;
    border: 1px solid #e5e7eb;
    border-radius: 0.5rem;
    font-size: 0.875rem;
    background-color: #f9fafb;
    transition: all 0.2s ease;
}

.search-input:focus {
    outline: none;
    border-color: #3b82f6;
    background-color: white;
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
}

.search-button {
    position: absolute;
    right: 0.5rem;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: #6b7280;
    cursor: pointer;
    padding: 0.25rem;
}

/* User actions */
.header-actions {
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.action-button {
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 2.5rem;
    height: 2.5rem;
    border-radius: 0.5rem;
    background: none;
    border: none;
    color: #6b7280;
    cursor: pointer;
    transition: all 0.2s ease;
}

.action-button:hover {
    background-color: #f3f4f6;
    color: #111827;
}

.notification-dot {
    position: absolute;
    top: 0.5rem;
    right: 0.5rem;
    width: 0.5rem;
    height: 0.5rem;
    background-color: #ef4444;
    border-radius: 50%;
    border: 2px solid white;
}

[data-notifications]:not([data-notifications="0"])::after {
    content: attr(data-notifications);
    position: absolute;
    top: 0.25rem;
    right: 0.25rem;
    background: #ef4444;
    color: white;
    font-size: 0.625rem;
    font-weight: 600;
    padding: 0.125rem 0.25rem;
    border-radius: 9999px;
    min-width: 1rem;
    text-align: center;
}

/* User menu */
.user-menu {
    position: relative;
}

.user-menu-button {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.25rem 0.5rem;
    background: none;
    border: 1px solid transparent;
    border-radius: 2rem;
    cursor: pointer;
    transition: all 0.2s ease;
}

.user-menu-button:hover {
    background-color: #f3f4f6;
    border-color: #e5e7eb;
}

.user-avatar {
    width: 2rem;
    height: 2rem;
    border-radius: 50%;
    object-fit: cover;
}

.dropdown-icon {
    color: #6b7280;
}

.user-dropdown {
    position: absolute;
    top: 100%;
    right: 0;
    margin-top: 0.5rem;
    background: white;
    border: 1px solid #e5e7eb;
    border-radius: 0.75rem;
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    min-width: 15rem;
    overflow: hidden;
}

.dropdown-header {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1rem;
}

.dropdown-avatar {
    width: 3rem;
    height: 3rem;
    border-radius: 50%;
    object-fit: cover;
}

.dropdown-info {
    display: flex;
    flex-direction: column;
}

.dropdown-name {
    font-weight: 600;
    color: #111827;
}

.dropdown-email {
    font-size: 0.875rem;
    color: #6b7280;
}

.dropdown-divider {
    height: 1px;
    background-color: #e5e7eb;
}

.dropdown-link {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 1rem;
    color: #4b5563;
    text-decoration: none;
    transition: all 0.2s ease;
}

.dropdown-link:hover {
    background-color: #f9fafb;
    color: #111827;
}

.logout-link {
    color: #ef4444;
}

.get-started-button {
    padding: 0.5rem 1.25rem;
    background-color: #3b82f6;
    color: white;
    font-weight: 500;
    border-radius: 0.5rem;
    text-decoration: none;
    transition: all 0.2s ease;
    display: none;
}

.get-started-button:hover {
    background-color: #2563eb;
    transform: translateY(-1px);
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}

/* Show get started button when logged out */
body:not(.user-logged-in) .get-started-button {
    display: block;
}

body:not(.user-logged-in) .action-button,
body:not(.user-logged-in) .user-menu {
    display: none;
}

/* Mobile menu */
.mobile-menu-button {
    display: none;
    background: none;
    border: none;
    cursor: pointer;
}

.menu-icon {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
}

.menu-icon span {
    display: block;
    width: 1.5rem;
    height: 2px;
    background-color: #4b5563;
    transition: all 0.3s ease;
}

.mobile-menu-button[aria-expanded="true"] .menu-icon span:nth-child(1) {
    transform: rotate(45deg) translate(5px, 5px);
}

.mobile-menu-button[aria-expanded="true"] .menu-icon span:nth-child(2) {
    opacity: 0;
}

.mobile-menu-button[aria-expanded="true"] .menu-icon span:nth-child(3) {
    transform: rotate(-45deg) translate(5px, -5px);
}

.mobile-nav {
    position: fixed;
    top: 4rem;
    left: 0;
    right: 0;
    background: white;
    border-bottom: 1px solid #e5e7eb;
    padding: 1rem;
    max-height: calc(100vh - 4rem);
    overflow-y: auto;
}

.mobile-search {
    margin-bottom: 1rem;
}

.mobile-search-input {
    width: 100%;
    padding: 0.75rem 1rem;
    border: 1px solid #e5e7eb;
    border-radius: 0.5rem;
    font-size: 1rem;
}

.mobile-nav-links {
    display: flex;
    flex-direction: column;
}

.mobile-nav-link {
    padding: 0.75rem 1rem;
    color: #4b5563;
    text-decoration: none;
    font-weight: 500;
    border-radius: 0.5rem;
    transition: all 0.2s ease;
}

.mobile-nav-link:hover {
    background-color: #f3f4f6;
    color: #111827;
}

/* Responsive */
@media (max-width: 1024px) {
    .header-search {
        display: none;
    }
}

@media (max-width: 768px) {
    .header-nav {
        display: none;
    }
    
    .mobile-menu-button {
        display: block;
    }
    
    .header-container {
        gap: 1rem;
    }
}

@media (max-width: 640px) {
    .brand-text {
        display: none;
    }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // User menu dropdown
    const userMenuButton = document.querySelector('.user-menu-button');
    const userDropdown = document.querySelector('.user-dropdown');
    
    if (userMenuButton && userDropdown) {
        userMenuButton.addEventListener('click', function() {
            const isOpen = !userDropdown.hidden;
            userDropdown.hidden = isOpen;
            userMenuButton.setAttribute('aria-expanded', !isOpen);
        });
        
        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            if (!event.target.closest('.user-menu')) {
                userDropdown.hidden = true;
                userMenuButton.setAttribute('aria-expanded', 'false');
            }
        });
    }
    
    // Mobile menu
    const mobileMenuButton = document.querySelector('.mobile-menu-button');
    const mobileNav = document.querySelector('.mobile-nav');
    
    if (mobileMenuButton && mobileNav) {
        mobileMenuButton.addEventListener('click', function() {
            const isOpen = !mobileNav.hidden;
            mobileNav.hidden = isOpen;
            mobileMenuButton.setAttribute('aria-expanded', !isOpen);
        });
    }
    
    // Add logged in class if user is authenticated
    // This would typically be set by your backend
    if (document.cookie.includes('authenticated=true')) {
        document.body.classList.add('user-logged-in');
    }
});
</script>