<!DOCTYPE html>
<html>
<head>
    <title>Test Add Bike UI Navigation</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-section { margin: 20px 0; padding: 10px; border: 1px solid #ccc; }
        .log { background: #f0f0f0; padding: 10px; margin: 10px 0; font-family: monospace; }
        .error { color: red; }
        .success { color: green; }
        button { margin: 5px; padding: 5px 10px; }
    </style>
</head>
<body>
    <h1>Add Bike UI Navigation Test</h1>
    
    <div class="test-section">
        <h2>Manual Navigation Test</h2>
        <p>Open the console (F12) and navigate through the UI at <a href="http://localhost:8081/add-bike/" target="_blank">http://localhost:8081/add-bike/</a></p>
        <p>Expected flow:</p>
        <ol>
            <li>Click "Motorcycle"</li>
            <li>Look for "Honda" in the list</li>
            <li>Click "Honda"</li>
            <li>Look for "2001" in the years</li>
            <li>Click "2001"</li>
            <li>Check what models appear</li>
        </ol>
    </div>
    
    <div class="test-section">
        <h2>API Test</h2>
        <button onclick="testAPI()">Test API Endpoints</button>
        <div id="apiResults" class="log"></div>
    </div>
    
    <div class="test-section">
        <h2>Direct Search Test</h2>
        <button onclick="searchHonda()">Search for Honda 2001</button>
        <div id="searchResults" class="log"></div>
    </div>
    
    <script>
        function log(message, type = '') {
            const className = type ? ` class="${type}"` : '';
            return `<div${className}>${message}</div>`;
        }
        
        async function testAPI() {
            const results = document.getElementById('apiResults');
            results.innerHTML = log('Testing API endpoints...');
            
            try {
                // Test 1: Manufacturers
                const manuResp = await fetch('http://localhost:8080/api/motorcycles/manufacturers');
                const manuData = await manuResp.json();
                results.innerHTML += log(`✓ Manufacturers: ${manuData.manufacturers.length} found`, 'success');
                results.innerHTML += log(`  Honda present: ${manuData.manufacturers.includes('Honda') ? 'YES' : 'NO'}`);
                
                // Test 2: Years
                const yearsResp = await fetch('http://localhost:8080/api/motorcycles/years');
                const yearsData = await yearsResp.json();
                results.innerHTML += log(`✓ Years: ${yearsData.years.length} found`, 'success');
                results.innerHTML += log(`  2001 present: ${yearsData.years.includes(2001) ? 'YES' : 'NO'}`);
                
                // Test 3: Health
                const healthResp = await fetch('http://localhost:8080/api/health');
                const healthData = await healthResp.json();
                results.innerHTML += log(`✓ Health: ${healthData.data.motorcycles} motorcycles loaded`, 'success');
                
            } catch (error) {
                results.innerHTML += log(`✗ Error: ${error.message}`, 'error');
            }
        }
        
        async function searchHonda() {
            const results = document.getElementById('searchResults');
            results.innerHTML = log('Searching for Honda 2001 motorcycles...');
            
            try {
                // Search with Honda query
                const searchResp = await fetch('http://localhost:8080/api/motorcycles/search?q=Honda&limit=200');
                const searchData = await searchResp.json();
                
                results.innerHTML += log(`Total results for "Honda": ${searchData.motorcycles.length}`);
                
                // Group by make
                const byMake = {};
                searchData.motorcycles.forEach(m => {
                    if (!byMake[m.make]) byMake[m.make] = 0;
                    byMake[m.make]++;
                });
                
                results.innerHTML += log('Results by make:');
                Object.entries(byMake).forEach(([make, count]) => {
                    results.innerHTML += log(`  ${make}: ${count}`);
                });
                
                // Filter for actual Honda
                const realHonda = searchData.motorcycles.filter(m => m.make === 'Honda');
                results.innerHTML += log(`<br>Actual Honda motorcycles: ${realHonda.length}`, realHonda.length > 0 ? 'success' : 'error');
                
                // Filter for Honda 2001
                const honda2001 = realHonda.filter(m => m.year === 2001);
                results.innerHTML += log(`Honda 2001 motorcycles: ${honda2001.length}`, honda2001.length > 0 ? 'success' : 'error');
                
                if (honda2001.length > 0) {
                    results.innerHTML += log('<br>Honda 2001 models found:');
                    const models = [...new Set(honda2001.map(m => m.package ? `${m.model} ${m.package}` : m.model))].sort();
                    models.forEach(model => {
                        results.innerHTML += log(`  • ${model}`);
                    });
                } else {
                    results.innerHTML += log('<br>Trying broader search...');
                    
                    // Try searching without query to get more results
                    const allResp = await fetch('http://localhost:8080/api/motorcycles/search?q=&limit=1000');
                    const allData = await allResp.json();
                    
                    const allHonda = allData.motorcycles.filter(m => m.make === 'Honda');
                    results.innerHTML += log(`Honda in first 1000 results: ${allHonda.length}`);
                    
                    if (allHonda.length === 0) {
                        results.innerHTML += log('Honda motorcycles are beyond the first 1000 results!', 'error');
                        results.innerHTML += log('The API needs modification to properly handle this large dataset.', 'error');
                    }
                }
                
            } catch (error) {
                results.innerHTML += log(`✗ Error: ${error.message}`, 'error');
            }
        }
        
        // Auto-run tests on load
        window.addEventListener('load', () => {
            testAPI();
        });
    </script>
</body>
</html>