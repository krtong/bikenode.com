#!/bin/bash
# Comprehensive action logging function
# Usage: log-action "ACTION_TYPE" "details"

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
ACTION_LOG="$SCRIPT_DIR/data/action-log.txt"
INSTANCE_ID="${CLAUDE_INSTANCE_ID:-instance-1}"

# Ensure action log exists
touch "$ACTION_LOG"

# Get parameters
ACTION_TYPE="$1"
DETAILS="$2"

if [ -z "$ACTION_TYPE" ]; then
    echo "ERROR: Action type required"
    echo "Usage: log-action \"ACTION_TYPE\" \"details\""
    exit 1
fi

# Create timestamp
TIMESTAMP=$(date '+%Y-%m-%d %H:%M:%S')

# Log the action
echo "[$TIMESTAMP] $INSTANCE_ID: $ACTION_TYPE - $DETAILS" >> "$ACTION_LOG"

# Also output to console if called directly
if [ "${BASH_SOURCE[0]}" = "${0}" ]; then
    echo "Action logged: $ACTION_TYPE"
fi